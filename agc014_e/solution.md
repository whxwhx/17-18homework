考虑每次找一个蓝色的路径，删去一条蓝色边，加入连接路径两端的红色边。这个过程中相当于每次选一条红色边，把它的对应到蓝色树上路径上删去一条边，要求每次这个这个红色边的两端点必须联通。

所以显然每次我们都应该删去一条被红色边恰好覆盖一次的蓝色边，每次删去这条边之后，链上-1，找全局大于0的最小值，可以用树链剖分维护一下，$O(nlog^2n)$。

我们也可以把操作倒序考虑，最后一个删掉和红色边一定是和蓝色边是重边，后面删掉的红色边一定是两个端点之间有一条恰好包含一条未加入的蓝色边的蓝色路径，从而我们把已经加入的蓝色边用并查集缩起来，然后每次合并两个点的时候启发式合并，枚举所有某个点集里的边把它的端点改掉。然后一旦有红色边和蓝色边成为重边，就把这个红色边替换为对应的蓝色边然后把两个端点缩起来即可。由于需要用set维护重边，并且要启发式合并，复杂度$O(nlog^2n)$。